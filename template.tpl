___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Datm Web Analytics Tag",
  "categories": [
    "ANALYTICS",
    "CONVERSIONS",
    "DATA_WAREHOUSING"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Datm",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAScAAAEnCAYAAADrWoVBAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAACdmSURBVHhe7Z0LuJVj+v+fajKNMk4VkplQESKTkKJIGekkUlPRSYYcLoqrmUGEmWGqMaO5pEg6TMerBlMxiTTIoSOJmJgppFGO0cgh/z7P/11+e+/2Yb3Pe1jPWvv7ua732mu/u3artdb7fe/nfu77e1f5bjdGCCE8o2rwVQghvELiJITwEomTEMJLJE5CCC+ROAkhvETiJITwEomTEMJLJE5CCC+ROAkhvETiJITwEomTEMJLJE5CCC+ROAkhvETiJITwEomTEMJLJE5CCC+ROAkhvETiJITwEomTEMJLJE5CCC+ROAkhvETiJITwEomTEMJLJE5CCC/RUE0hCowvv/zSvPfee/b49NNPzSeffGI+++wz+zjz/a5du8y+++67x7HffvuZgw8+2Bx22GGmZs2awW/MDRInIQqAjz/+2Lz22mtm7dq15tVXXzVvv/22FaL//e9/3x+IVuYxl/2PfvQjU6NGDfu16OMf//jH5qc//ak59thjTdOmTe3Xgw46KPiX0kPiJESesnnzZrN8+XIrSK+//rrZuHGjPffBBx+YL774IvhTbiBUderUMfXq1TM/+clPzFFHHWWFqnnz5ubII48M/lSySJyEyDMQoKeeeso88cQT5pVXXrHff/TRR+abb74J/kS8VKtWzS75EKomTZqYdu3ambPPPjtxkZI4CZEnvP/++9+L0osvvmgjJZZoafLDH/7QHHrooeakk06yIsWRlEhJnITwHETp6aefNosWLfpelHbs2BH8NDcgUvXr17fLvPbt21uROvzww4OfxoPESQiPIck9adIks3DhQvOf//wn56JUEkSKnb0zzzzTDBw40Jx66qnBT6IjcRLCQz7//HPz3HPPmcmTJ5vFixebrVu3Bj/xE0oQWrdubS655BIbSfF9VCROQngGy7h58+aZqVOn2rKAqDtvacEOX+PGjU2PHj1Mnz59Ii/zJE5CeMS//vUvu4ybPXu2rVXKt8uzSpUqdlevS5cuZtCgQTYn5YrESQhPoFZp3LhxZs6cOWbLli3B2fzkgAMOMB07djRXXnmlcx5KvXVCeMBbb71lJk6caGbOnJn3wgTUXc2fP9/cd999Zs2aNcHZcEichMgxmzZtMlOmTDEzZszwPvEdBnr4EKgJEyaY9evXB2ezR+IkRA4hSiJaYleOSu9C48MPP7TJfaJCSiHCIHESIkew9OHCJbKgsLJQ+e9//2umT59uE/1hlqxKiAuRI2hDufHGG23zbhLsvffedjufpt1DDjmkmDVK1apVv7dQ4aBZ+M033zQbNmww27dvD35DvPA8+P9efPHFwZnykTgJkQMoExgzZox58MEHrZVJXGB3gsUJW/h8pe8NuxPOF7VGQZyKWqkgSAgUS69169aZVatWmZdfftlGd3Gx1157mU6dOplbbrnFHH/88cHZspE4CZEyCMK0adPMyJEjrSFcHOyzzz7mxBNPtNv3p512mrU5qVu3rhWjMOzcudNs27bNvPPOO2blypVmwYIFtp8vLpGqXbu2GTJkiLn++uvtcy4PiZMQKbN69Wpz2223mYcffjg4484PfvAD67N00UUXmTPOOMMunQ488MDgp9HAPZOi0GXLlpm5c+far19//XXwU3datWplhZlm4fKodutugsdCiIRh94rqb3bootqd0L927rnnmmuuucZ069bNChN5prigqZdq76OPPto0bNjQLgWJ9KK205DjYml5wgknlBs9SZyESBGWSOPHjzdvvPFGcMYNnAD69etnrrrqKnPKKafYnFJSICTYoxx33HFWEN99910rsq6wdMRdoUGDBvZ3loVKCYRICS7oZ5991iaao0A+CXsSWkOIPhCPpCGZTVPvgAED7L+LI2YUqIjHOI8m57KQOAmREuyErVixwtqhuEJJQO/eva04MYQgbdj569mzp7n00ksjuQ6wpMVxgaMsJE5CpATlA1GiJhLdF154oRk8eLCNnnIFu4C9evWyAolYukL0hAd6WUichEgBtuKJEqK0qFAqgE/SEUccEZzJHSTKL7jgAnPWWWcFZ8LDMpfXpKylncRJiBT497//bbvzXbfiSR537tw5q+LFtEAk8W2i2NMFpsVQlU7RZ2lInIRIgShLOrb027RpY4UgbFFlkmSeV9euXZ1LGFjalfW6SJyESBim8RIduC7pSDxTsJjLPFNZkH9CoMorCSgPlna8NjQHl0TiJETCIE4UL7ou6SiubNGihS2C9A1seSnSZI6dCyztECaJkxA5gNIBqqJdoLjymGOOyUnZQLYcfPDB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f5gbb7zR7tS5gC3KkCFDzHXXXac+upiQOIm8gWptXALWrl1rXn31VfP2229bIaJoMnMgWpnHfLSp1K5Ro4b9WvQxAsLyC+tcRIoG34kTJzq7D5Bnuv32203r1q2DMyIqEifhNZs3b7Y7aAgSnkobN26053AM+OKLL4I/5QZCVadOHdv79tFHH5l33303+Ek4+PtXXHGFGT58uKKmGJE4CS9BgNg5e+KJJ8wrr7xiv0dASFz7RsuWLc3IkSNN+/btgzMiDiROwivef//970XpxRdftJESSzRfwRbl0ksvNTfffLPcB2JG4iS8AFEi77No0aLvRck1/5MmlA6MGDHCdO3aNTgj4kLiJHIOSe5JkyaZhQsX2q38fBAlILHet29fc+utt5p69eoFZ0VcqM5J5IzPP//cbuHfcccdZvLkyVak8kWYQLYoySJxEjmBZRyCdMstt5hHH33UbN26NfhJfkBTL60qskVJDomTSB1cJseOHWvuvvtua4UbtSQgF5ANoe4q30Q1n5A4iVShVglhIsf01ltv2Ys8H6H6nPor/i+0vYj4kTiJ1ECMqMKeOXOm7WXLd6i7mj9/vrnvvvvMmjVrgrMiLiROIhWwIZkyZYqZMWNGQS2F6OFDoCZMmGDWr18fnBVxIHESiUOURLREApxK70Ljww8/NPPmzbNRYRRXA1EciZNIFJY+XLhEFhRWFioMQ5g+fbrNpRXCktUHVIQpEoU2FKxIooxZKo+9997bWuMeddRR5pBDDilmjVK1atXvLVQ4aBZmiu+GDRucp/hWBM+D/+/FF18cnBGuSJxEYmBpMmbMGPPggw9aK5O4oPP/mGOOsWO+sTw58sgjbSEk54taoyBORa1UECQECjvedevWWefLl19+2UZ3cbHXXnuZTp062fqt448/PjgrXJA4iURAEKZNm2a79TGEiwOabCl87Nixo63MpkIbkzfEKAw7d+4027ZtM++88441l1uwYIHt54tLpLDrxXju+uuvt89ZuCFxEolAVHLbbbeZhx9+ODjjDoMDmjZtai666CJzxhln2KXTgQceGPw0GrhnUhTKEM25c+far19//XXwU3ew60WYmcQi3Kh2K12LQsQIu1ezZ8+2O3RR7U6w1D333HPNNddcY7p162aFiTxTXOD3TdMu/t8NGza0S0EivahV6+S4WFqecMIJip4ckTiJ2GGJ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\u003d"
  },
  "description": "Master web analytics pixel for web and server tracking.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "tagConfig",
    "displayName": "Tag configuration",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "serverDomain",
        "displayName": "Server Domain",
        "simpleValueType": true,
        "help": "(Required) Domain of your reporting endpoint.  Do not include the protocol (https://)",
        "valueHint": "capi.example.com"
      },
      {
        "type": "TEXT",
        "name": "serverPath",
        "displayName": "Server Path",
        "simpleValueType": true,
        "defaultValue": "/web-pixel/",
        "help": "(Required) The path for your reporting endpoint."
      },
      {
        "type": "TEXT",
        "name": "tag",
        "displayName": "Tag",
        "simpleValueType": true,
        "help": "(Recommended) Site or company name used to identify the source of the data."
      },
      {
        "type": "CHECKBOX",
        "name": "useCookies",
        "checkboxText": "Enable cookies",
        "simpleValueType": true,
        "help": "Used to store session and client ID values (datm_session and datm_client).",
        "defaultValue": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "tagOverride",
    "displayName": "Tag parameter overrides",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "sessionId",
        "displayName": "Session ID",
        "simpleValueType": true,
        "help": "(Optional) A unique session identifier.  If a value is not provided then one will be created.",
        "enablingConditions": [
          {
            "paramName": "useCookies",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "clientId",
        "displayName": "Client ID",
        "simpleValueType": true,
        "help": "(Optional) A unique browser identifier.  If a value is not provided then one will be created.",
        "enablingConditions": [
          {
            "paramName": "useCookies",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "cookieDomain",
        "displayName": "Custom cookie domain",
        "simpleValueType": true,
        "help": "(Optional) Cookies will be set to parent domain if no value is provided.",
        "enablingConditions": [
          {
            "paramName": "useCookies",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ],
    "help": "(Optional) Use these fields to override any default values that are automatically tracked"
  },
  {
    "type": "GROUP",
    "name": "eventConfig",
    "displayName": "Event configuration",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "RADIO",
        "name": "eventCountMethod",
        "displayName": "Event Count Method",
        "radioItems": [
          {
            "value": "unique",
            "displayValue": "Unique events only"
          },
          {
            "value": "all",
            "displayValue": "All events"
          }
        ],
        "simpleValueType": true,
        "help": "Count all events or just unique occurrences of each event.  Uniqueness is determined on a per page basis."
      },
      {
        "type": "TEXT",
        "name": "eventDetail",
        "displayName": "Event Detail",
        "simpleValueType": true,
        "help": "(Optional) Next level of detail beyond event name"
      },
      {
        "type": "TEXT",
        "name": "userObject",
        "displayName": "User provided data",
        "simpleValueType": true,
        "help": "(Optional) An object variable that contains multiple user attributes."
      },
      {
        "type": "TEXT",
        "name": "userId",
        "displayName": "User ID",
        "simpleValueType": true,
        "help": "(Optional) A unique ID associated with a single user."
      },
      {
        "type": "TEXT",
        "name": "userType",
        "displayName": "User Type",
        "simpleValueType": true,
        "help": "(Optional) The type or category of user.  E.g. \u0027new\u0027 vs \u0027returning\u0027."
      },
      {
        "type": "TEXT",
        "name": "pageName",
        "displayName": "Page Name",
        "simpleValueType": true,
        "help": "(Optional) A friendly page name used for reporting purposes; typically a grouping of page paths with unique identifiers and details removed."
      },
      {
        "type": "TEXT",
        "name": "pageGroup",
        "displayName": "Page Group",
        "simpleValueType": true,
        "help": "(Optional) The category or type of page."
      },
      {
        "type": "TEXT",
        "name": "ecommerceData",
        "displayName": "Ecommerce Variable",
        "simpleValueType": true,
        "help": "(Recommended) A variable containing common ecommerce attributes, including order and product details."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "additonalParams",
        "displayName": "Additional parameters",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter Name",
            "name": "key",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Parameter Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "help": "(Optional) Additional top-level parameters"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "customParams",
        "displayName": "Custom Parameters",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter Name",
            "name": "key",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Parameter Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "help": "(Optional) Additional custom attributes nested in a custom attribute field."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "eventOverride",
    "displayName": "Event parameter overrides",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "eventId",
        "displayName": "Event ID",
        "simpleValueType": true,
        "help": "(Optional) A unique event identifier.  A value will automatically be created if one is not provided."
      },
      {
        "type": "TEXT",
        "name": "eventName",
        "displayName": "Event Name",
        "simpleValueType": true,
        "help": "(Optional)  Defaults to data layer event name if not defined."
      },
      {
        "type": "TEXT",
        "name": "eventTime",
        "displayName": "Event Time",
        "simpleValueType": true,
        "help": "(Optional) A timestamp for when the event was executed.  A value will automatically be created if one is not provided."
      },
      {
        "type": "TEXT",
        "name": "pageUrl",
        "displayName": "Page URL",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "pageHost",
        "displayName": "Page Host",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "pagePath",
        "displayName": "Page Path",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "pageTitle",
        "displayName": "Page Title",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "referrerUrl",
        "displayName": "Referrer URL",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "referrerHost",
        "displayName": "Referrer Host",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "referrerPath",
        "displayName": "Referrer Path",
        "simpleValueType": true
      }
    ],
    "help": "(Optional) Use these fields to override any default values that are automatically tracked"
  },
  {
    "type": "GROUP",
    "name": "debugConfig",
    "displayName": "Debug",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "isLoggingEnabled",
        "checkboxText": "Enable Logging",
        "simpleValueType": true,
        "help": "Select to display debug notes in the browser console.  Only applicable when in preview mode."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

/*
TODO: - add cookie consent integration
        - operate in cookie-less mode when consent declined
        - reprocess queue if consent is granted
        - create logic for de-duping reprocessed requests
*/

const copyFromDataLayer = require('copyFromDataLayer');
const getUrl = require('getUrl');
const getReferrerUrl = require('getReferrerUrl');
const readTitle = require('readTitle');
const injectScript = require('injectScript');
const callInWindow = require('callInWindow');
const logToConsole = require('logToConsole');
const setInWindow = require('setInWindow');
const templateStorage = require('templateStorage');
const makeTableMap = require('makeTableMap');

// Tag config
const serverDomain = data.serverDomain;
const serverPath = data.serverPath;
const tag = data.tag;
const useCookies = data.useCookies;
const sessionId = data.sessionId;
const clientId = data.clientId;
const cookieDomain = data.cookieDomain;

// Event config
const eventCountMethod = data.eventCountMethod;
const eventDetail = data.eventDetail;
const userObject = data.userObject || {};
const userId = data.userId;
const userType = data.userType;
const pageName = data.pageName;
const pageGroup = data.pageGroup;
const ecommerceData = data.ecommerceData || {};
const additionalParams = data.additionalParams || [];
const customParams = makeTableMap(data.customParams || [], 'key', 'value');
const eventId = data.eventId;
const event = data.eventName || copyFromDataLayer('event');
const eventTime = data.eventTime;

// Default parameters
const pageUrl = data.pageUrl || getUrl() ;
const pageHost = data.pageHost || getUrl('host');
const pagePath = data.pagePath || getUrl('path');
const pageTitle = data.pageTitle || readTitle();
const referrerUrl = data.referrerUrl || getReferrerUrl();
const referrerHost = data.referrerHost || getReferrerUrl('host');
const referrerPath = data.referrerPath || getReferrerUrl('path');

// Debug config
const isLoggingEnabled = data.isLoggingEnabled;

// Exclude GTM auto events
if (getUrl('host') === 'gtm-msr.appspot.com') {
  return data.gtmOnSuccess();
}

const scriptSource = 'https://' + serverDomain + '/web-pixel.min.js';

// Initialize pixel object
if (setInWindow('datmWeb', []) === true) {
  log('datmWeb object not yet defined');
  
  const config = {
    serverDomain: serverDomain,
    serverPath: serverPath,
    useCookies: useCookies,
    cookieDomain: cookieDomain
  };

  callInWindow('datmWeb.push', config);
  injectScript(scriptSource);

  log('initialized pixel object', config);
}

// Unique event tracking
log('checking uniqueness setting:', event);

if (eventCountMethod === 'unique') {

  if (templateStorage.getItem(event)) {
    log('event already executed on page:', event);
    return data.gtmOnSuccess();
  }
  else {
    templateStorage.setItem(event, true);
  }

}

log('no uniqueness constraint applied');

// Build event payload
log('building event data');

let payload = {
  event: event,
  event_id: eventId,
  event_time: eventTime,
  tag: tag,
  event_detail: eventDetail,
  session_id: sessionId,
  client_id: clientId,
  user: {
    id: userId,
    type: userType,
    email: userObject.email,
    phone: userObject.phone_number,
  },
  page: {
    url: pageUrl,
    host: pageHost,
    path: pagePath,
    title: pageTitle,
    name: pageName,
    group: pageGroup
  },
  referrer: {
    url: referrerUrl,
    host: referrerHost,
    path: referrerPath
  },
  ecommerce: ecommerceData,
  custom: customParams
};

// Additional top-level parameters
for (let i = 0; i < additionalParams.length; i++) {
  let key = additionalParams[i].key;
  let value = additionalParams[i].value;

  payload[key] = value;
}

// Send event payload
callInWindow('datmWeb.push', payload);
log('server event sent', payload);

return data.gtmOnSuccess();


/* FUNCTIONS */

function log(value1, value2) {
  if (!isLoggingEnabled) {
    return;
  }
    
  if (typeof value2 !== 'undefined') {
    logToConsole('GTM:', value1, value2);
  }
  else {
    logToConsole('GTM:', value1);
  }
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "datmWeb"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "datmWeb.push"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.datm.cc/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_referrer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedKeys",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_title",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_template_storage",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Purchase
  code: |-
    const mockData = {
      serverDomain: 'capi.datm.cc',
      serverPath: '/web-pixel/test',
      useCookies: true,
      cookieDomain: null,
      sessionId: null,
      clientId: null,
      eventName: 'purchase',
      eventId: 'event-id',
      eventTime: 'event-time',
      eventCountMethod: 'all',
      userVariable: {
        user_email: 'user-email',
        user_phone: 'user-phone'
      },
      userId: 'user-id',
      userType: 'user-type',
      pageName: 'page-name',
      pageGroup: 'page-group',
      ecommerceData: {
        transaction_id: '1002604619',
        affiliation: 'aem/magento',
        value: '49.95',
        tax: '5.43',
        shipping: '11.14',
        currency: 'USD',
        coupon: "coupon-code",
        payment_type: "Apple Pay",
        shipping_tier: "Shipping - Premium Ground (3-5 business days)",
        items: [
           {
              item_id: "AQ-230A-2A2VT",
              item_name: "AQ-230A-2A2VT",
              currency: "USD",
              index: 0,
              item_brand: "CASIO",
              item_category: "watch",
              item_category2: "Vintage",
              item_category3: "",
              price: 49.95,
              quantity: 1
           }
        ]
      },
      customParams: [
        {key: 'param1', value: 'value1'},
        {key: 'param2', value: 'value2'}
      ],
      isLoggingEnabled: true
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 4/10/2024, 18:14:02
